import{G as n,J as f,M as u,Sb as b,Tb as a,Ub as k,Xc as m,a as d,b as c,g as l,l as h,m as p,t as s}from"./chunk-TBJQDHG5.js";var v=class g{constructor(e,t){this.http=e;this.authService=t}apiUrl="http://localhost:3000/api";bookingsSubject=new l([]);bookings$=this.bookingsSubject.asObservable();loadingSubject=new l(!1);loading$=this.loadingSubject.asObservable();getHeaders(){let e=this.authService.getToken(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),new b(t)}handleError(e){console.error("BookingService Error:",e);let t="An unexpected error occurred";return e.error?.message?t=e.error.message:e.message&&(t=e.message),h(()=>new Error(t))}getRestaurants(e){let t=new a;return e&&(e.location&&(t=t.set("location",e.location)),e.cuisine&&(t=t.set("cuisine",e.cuisine)),e.priceRange&&(t=t.set("priceRange",e.priceRange)),e.page&&(t=t.set("page",e.page)),e.limit&&(t=t.set("limit",e.limit)),e.latitude&&(t=t.set("latitude",e.latitude)),e.longitude&&(t=t.set("longitude",e.longitude)),e.radius&&(t=t.set("radius",e.radius))),this.http.get(`${this.apiUrl}/restaurants`,{params:t}).pipe(p(i=>{console.log("API Response:",i);let r=[];if(Array.isArray(i))r=i;else if(i.restaurants&&Array.isArray(i.restaurants))r=i.restaurants;else if(i.data&&Array.isArray(i.data))r=i.data;else throw console.error("Invalid response format:",i),new Error("Invalid response format from server");return{restaurants:r.map(o=>c(d({},o),{id:o._id,rating:o.averageRating||0,timing:this.formatOpeningHours(o.openingHours),reviews:0})),pagination:i.pagination||{page:1,limit:10,total:r.length,pages:1},filters:i.filters||{}}}),s(this.handleError))}formatOpeningHours(e){if(!e)return"Hours vary";let i=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],r=e[i];return r?.open&&r?.close?`Open until ${r.close}`:"Hours vary"}checkAvailability(e){this.loadingSubject.next(!0);let t=new a().set("restaurantId",e.restaurantId).set("date",e.date);return this.http.get(`${this.apiUrl}/bookings/availability`,{params:t,headers:this.getHeaders()}).pipe(n(()=>this.loadingSubject.next(!1)),s(i=>(this.loadingSubject.next(!1),this.handleError(i))))}createBooking(e){return this.loadingSubject.next(!0),this.http.post(`${this.apiUrl}/bookings`,e,{headers:this.getHeaders()}).pipe(n(()=>{this.loadingSubject.next(!1),this.refreshUserBookings()}),s(t=>(this.loadingSubject.next(!1),this.handleError(t))))}getUserBookings(e){this.loadingSubject.next(!0);let t=new a;return e?.status&&e.status!=="all"&&(t=t.set("status",e.status)),e?.dateFrom&&(t=t.set("dateFrom",e.dateFrom)),e?.dateTo&&(t=t.set("dateTo",e.dateTo)),this.http.get(`${this.apiUrl}/bookings/my`,{params:t,headers:this.getHeaders()}).pipe(n(i=>{this.loadingSubject.next(!1),this.bookingsSubject.next(i)}),s(i=>(this.loadingSubject.next(!1),this.handleError(i))))}getBooking(e){return this.http.get(`${this.apiUrl}/bookings/${e}`,{headers:this.getHeaders()}).pipe(s(this.handleError))}cancelBooking(e){return this.loadingSubject.next(!0),this.http.delete(`${this.apiUrl}/bookings/${e}`,{headers:this.getHeaders()}).pipe(n(()=>{this.loadingSubject.next(!1),this.refreshUserBookings()}),s(t=>(this.loadingSubject.next(!1),this.handleError(t))))}getBookingStats(){return this.http.get(`${this.apiUrl}/bookings/stats`,{headers:this.getHeaders()}).pipe(s(this.handleError))}refreshUserBookings(){this.getUserBookings().subscribe({next:()=>{},error:e=>{console.error("Failed to refresh user bookings:",e)}})}isBookingCancellable(e){let t=new Date(`${e.date}T${e.time}`),i=new Date;return(t.getTime()-i.getTime())/(1e3*3600)>2&&e.status==="confirmed"}isBookingUpcoming(e){return new Date(`${e.date}T${e.time}`)>new Date&&e.status==="confirmed"}formatBookingDateTime(e){return new Date(`${e.date}T${e.time}`).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}static \u0275fac=function(t){return new(t||g)(u(k),u(m))};static \u0275prov=f({token:g,factory:g.\u0275fac,providedIn:"root"})};export{v as a};
